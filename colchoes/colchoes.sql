-- MySQL Script generated by MySQL Workbench
-- Sun Nov 30 14:09:03 2025
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='TRADITIONAL,ALLOW_INVALID_DATES';

-- -----------------------------------------------------
-- Schema mydb
-- -----------------------------------------------------

-- -----------------------------------------------------
-- Schema mydb
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `mydb` DEFAULT CHARACTER SET utf8 ;
USE `mydb` ;

-- -----------------------------------------------------
-- Table `mydb`.`marca_tb`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`marca_tb` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `descricao` VARCHAR(45) NULL COMMENT 'LINHA',
  PRIMARY KEY (`id`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`tipo_tb`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`tipo_tb` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `descricao` VARCHAR(45) NULL,
  PRIMARY KEY (`id`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`produto_tb`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`produto_tb` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `descricao` VARCHAR(45) NULL,
  `preco` DECIMAL(2) NULL,
  `marca_tb_id` INT NOT NULL,
  `tipo_tb_id` INT NOT NULL,
  PRIMARY KEY (`id`, `marca_tb_id`, `tipo_tb_id`),
  INDEX `fk_produto_tb_marca_tb_idx` (`marca_tb_id` ASC) VISIBLE,
  INDEX `fk_produto_tb_tipo_tb1_idx` (`tipo_tb_id` ASC) VISIBLE,
  CONSTRAINT `fk_produto_tb_marca_tb`
    FOREIGN KEY (`marca_tb_id`)
    REFERENCES `mydb`.`marca_tb` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_produto_tb_tipo_tb1`
    FOREIGN KEY (`tipo_tb_id`)
    REFERENCES `mydb`.`tipo_tb` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`unidade_tb`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`unidade_tb` (
  `id` INT NOT NULL,
  `cnpj` VARCHAR(14) NULL,
  `nome` VARCHAR(45) NULL,
  PRIMARY KEY (`id`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`estoque_tb`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`estoque_tb` (
  `unidade_tb_id` INT NOT NULL,
  `produto_tb_id` INT NOT NULL,
  `quantidade` INT NULL,
  PRIMARY KEY (`unidade_tb_id`, `produto_tb_id`),
  INDEX `fk_unidade_tb_has_produto_tb_produto_tb1_idx` (`produto_tb_id` ASC) VISIBLE,
  INDEX `fk_unidade_tb_has_produto_tb_unidade_tb1_idx` (`unidade_tb_id` ASC) VISIBLE,
  CONSTRAINT `fk_unidade_tb_has_produto_tb_unidade_tb1`
    FOREIGN KEY (`unidade_tb_id`)
    REFERENCES `mydb`.`unidade_tb` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_unidade_tb_has_produto_tb_produto_tb1`
    FOREIGN KEY (`produto_tb_id`)
    REFERENCES `mydb`.`produto_tb` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`pessoa_tb`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`pessoa_tb` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `cpf` VARCHAR(11) NULL,
  `nome` VARCHAR(45) NULL,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `id_UNIQUE` (`id` ASC) VISIBLE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`cliente_tb`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`cliente_tb` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `pessoa_tb_id` INT NOT NULL,
  PRIMARY KEY (`id`, `pessoa_tb_id`),
  UNIQUE INDEX `id_UNIQUE` (`id` ASC) VISIBLE,
  INDEX `fk_cliente_tb_pessoa_tb1_idx` (`pessoa_tb_id` ASC) VISIBLE,
  CONSTRAINT `fk_cliente_tb_pessoa_tb1`
    FOREIGN KEY (`pessoa_tb_id`)
    REFERENCES `mydb`.`pessoa_tb` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`cargo_tb`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`cargo_tb` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `descricao` VARCHAR(45) NULL,
  `salario` DECIMAL(2) NULL,
  `comissao_adicional` DECIMAL(2) NULL,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `id_UNIQUE` (`id` ASC) VISIBLE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`funcionario_tb`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`funcionario_tb` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `pessoa_tb_id` INT NOT NULL,
  `matricula` INT NULL,
  `unidade_tb_id` INT NOT NULL,
  `cargo_tb_id` INT NOT NULL,
  PRIMARY KEY (`id`, `pessoa_tb_id`, `unidade_tb_id`, `cargo_tb_id`),
  UNIQUE INDEX `id_UNIQUE` (`id` ASC) VISIBLE,
  INDEX `fk_funcionario_tb_pessoa_tb1_idx` (`pessoa_tb_id` ASC) VISIBLE,
  INDEX `fk_funcionario_tb_unidade_tb1_idx` (`unidade_tb_id` ASC) VISIBLE,
  INDEX `fk_funcionario_tb_cargo_tb1_idx` (`cargo_tb_id` ASC) VISIBLE,
  CONSTRAINT `fk_funcionario_tb_pessoa_tb1`
    FOREIGN KEY (`pessoa_tb_id`)
    REFERENCES `mydb`.`pessoa_tb` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_funcionario_tb_unidade_tb1`
    FOREIGN KEY (`unidade_tb_id`)
    REFERENCES `mydb`.`unidade_tb` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_funcionario_tb_cargo_tb1`
    FOREIGN KEY (`cargo_tb_id`)
    REFERENCES `mydb`.`cargo_tb` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`pedido_tb`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`pedido_tb` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `unidade_tb_id` INT NOT NULL,
  `funcionario_tb_id` INT NOT NULL,
  `valor_total` DECIMAL(2) NULL,
  `comissao_adicional` DECIMAL(2) NULL,
  PRIMARY KEY (`id`, `unidade_tb_id`, `funcionario_tb_id`),
  INDEX `fk_pedido_tb_unidade_tb1_idx` (`unidade_tb_id` ASC) VISIBLE,
  INDEX `fk_pedido_tb_funcionario_tb1_idx` (`funcionario_tb_id` ASC) VISIBLE,
  CONSTRAINT `fk_pedido_tb_unidade_tb1`
    FOREIGN KEY (`unidade_tb_id`)
    REFERENCES `mydb`.`unidade_tb` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_pedido_tb_funcionario_tb1`
    FOREIGN KEY (`funcionario_tb_id`)
    REFERENCES `mydb`.`funcionario_tb` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`item_tb`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`item_tb` (
  `pedido_tb_id` INT NOT NULL,
  `produto_tb_id` INT NOT NULL,
  `quantidade` INT NULL,
  PRIMARY KEY (`pedido_tb_id`, `produto_tb_id`),
  INDEX `fk_pedido_tb_has_produto_tb_produto_tb1_idx` (`produto_tb_id` ASC) VISIBLE,
  INDEX `fk_pedido_tb_has_produto_tb_pedido_tb1_idx` (`pedido_tb_id` ASC) VISIBLE,
  CONSTRAINT `fk_pedido_tb_has_produto_tb_pedido_tb1`
    FOREIGN KEY (`pedido_tb_id`)
    REFERENCES `mydb`.`pedido_tb` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_pedido_tb_has_produto_tb_produto_tb1`
    FOREIGN KEY (`produto_tb_id`)
    REFERENCES `mydb`.`produto_tb` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;


ALTER TABLE produto_tb 
MODIFY preco DECIMAL(10,2);

ALTER TABLE cargo_tb 
MODIFY comissao_adicional DECIMAL(4,3);

ALTER TABLE pedido_tb
MODIFY valor_total DECIMAL(10,2),
MODIFY comissao_adicional DECIMAL(10,2);

ALTER TABLE pedido_tb 
MODIFY id INT NOT NULL;

ALTER TABLE pedido_tb DROP FOREIGN KEY fk_pedido_tb_unidade_tb1;
ALTER TABLE pedido_tb DROP FOREIGN KEY fk_pedido_tb_funcionario_tb1;

ALTER TABLE pedido_tb 
DROP PRIMARY KEY;

ALTER TABLE pedido_tb
MODIFY id INT NOT NULL AUTO_INCREMENT;


INSERT INTO marca_tb (descricao) VALUES
('Ortobom'),
('Castor'),
('Americanflex'),
('Emma'),
('Herval');

INSERT INTO tipo_tb (descricao) VALUES
('Colchão Casal'),
('Colchão Solteiro'),
('Colchão Queen'),
('Colchão King'),
('Box Baú'),
('Travesseiro'),
('Protetor de Colchão');


INSERT INTO produto_tb (descricao, preco, marca_tb_id, tipo_tb_id) VALUES
('Colchão Casal Ortopédico', 1599.90, 1, 1),
('Colchão Solteiro Ortobom D33', 899.90, 1, 2),
('Colchão Queen Molas Ensacadas', 2899.90, 3, 3),
('Colchão King Castor Premium', 4499.90, 2, 4),
('Box Baú Casal Marrom', 1199.90, 5, 5),
('Travesseiro Viscoelástico', 129.90, 4, 6),
('Protetor Impermeável Queen', 89.90, 4, 7);



INSERT INTO unidade_tb (id, cnpj, nome) VALUES
(1, '12345678000199', 'Colchões Master - Centro'),
(2, '98765432000111', 'Colchões Master - Shopping Norte'),
(3, '45678912000155', 'Colchões Master - Bairro Sul');


INSERT INTO pessoa_tb (cpf, nome) VALUES
('11122233344', 'João Pereira'),
('55566677788', 'Ana Maria'),
('99988877766', 'Carlos Henrique'),
('22233344455', 'Mariana Souza'),
('44455566677', 'Roberto Dias');

INSERT INTO cliente_tb (pessoa_tb_id) VALUES
(1),
(2),
(4);


INSERT INTO cargo_tb (descricao, salario, comissao_adicional) VALUES
('Vendedor', 2200, 0.05),
('Gerente', 4500, 0.10),
('Atendente', 1800, 0.03);



INSERT INTO funcionario_tb (pessoa_tb_id, matricula, unidade_tb_id, cargo_tb_id) VALUES
(3, 101, 1, 1),  -- Carlos é vendedor do Centro
(5, 102, 2, 2),  -- Roberto é gerente do Shopping
(4, 103, 3, 3);  -- Mariana é atendente do Bairro Sul


INSERT INTO pedido_tb (unidade_tb_id, funcionario_tb_id, valor_total, comissao_adicional) VALUES
(1, 1, 1799.80, 90),
(2, 2, 4499.90, 200),
(3, 3, 129.90, 10);



INSERT INTO item_tb (pedido_tb_id, produto_tb_id, quantidade) VALUES
(16, 1, 1), -- Casal Ortopédico
(16, 6, 2), -- Dois travesseiros
(17, 4, 1), -- Colchão King Premium
(18, 6, 1); -- Travesseiro


INSERT INTO estoque_tb (unidade_tb_id, produto_tb_id, quantidade) VALUES
(1, 1, 5),
(1, 6, 20),
(2, 4, 2),
(2, 3, 3),
(3, 6, 10),
(3, 7, 8);

SHOW COLUMNS FROM pessoa_tb;

UPDATE pedido_tb SET funcionario_tb_id = 4 WHERE id = 16;
UPDATE pedido_tb SET funcionario_tb_id = 5 WHERE id = 17;
UPDATE pedido_tb SET funcionario_tb_id = 6 WHERE id = 18;




SELECT * FROM funcionario_tb;
SELECT * FROM pedido_tb;
SELECT * FROM produto_tb;
SELECT * FROM unidade_tb;
SELECT * FROM pessoa_tb;


-- Pedidos com nome da unidade e funcionário
SELECT
    p.id AS pedido_id,
    u.nome AS unidade,
    ps.nome AS funcionario,
    p.valor_total,
    p.comissao_adicional
FROM pedido_tb p
JOIN unidade_tb u ON p.unidade_tb_id = u.id
JOIN funcionario_tb f ON p.funcionario_tb_id = f.id
JOIN pessoa_tb ps ON f.pessoa_tb_id = ps.id;

-- Itens com nome do produto
SELECT 
    i.pedido_tb_id AS pedido,
    pr.descricao AS produto,
    i.quantidade
FROM item_tb i
JOIN produto_tb pr ON i.produto_tb_id = pr.id;


SELECT f.id, pe.nome
FROM funcionario_tb f
JOIN pessoa_tb pe ON f.pessoa_tb_id = pe.id;




